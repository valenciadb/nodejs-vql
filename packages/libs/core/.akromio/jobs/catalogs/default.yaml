spec: v1.0
desc: Catalog for automating the project tasks.

dataset:
  - const: dist
    desc: The dist dir.
    value: dist
  
  - const: docs
    desc: The docs dir.
    value: docs

defaultJobName: default

jobs:
  - macro: default
    desc: Build the project and run its unit tests.
    steps:
      - lint
      - build
      - test/unit
  
  - macro: build
    desc: Build the project.
    onError: finish
    steps:
      - fs.emptyDir $(dist)
      - [exec.log, npx tsc --project tsconfig.json]
  
  - macro: lint
    desc: Linter.
    steps:
      - [exec.log, npx eslint . --fix]
  
  - group: test
    jobs:
    - macro: test/unit
      desc: Run the unit tests.
      steps:
        - [exec.log, npm t]
    
    - macro: cov
      desc: Run the unit tests with coverage.
      steps:
        - build
        - [exec.log, npx npm run cov]
  
  - group: docs
    jobs:
    - macro: docs
      desc: Generates the API doc.
      steps:
        - fs.remove $(docs)
        - [exec, npx typedoc]

    - macro: docs/open
      desc: Open the docs dir in the default browser.
      steps:
        - xdg.open $(docs)/index.html
  
  - macro: make
    desc: Build, test and document the project.
    steps:
      - default
      - docs
  